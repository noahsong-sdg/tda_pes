# TDA x PES

A project that develops a persistent homology (PH) pipeline for analyzing n-dimensional potential energy landscapes (PEL). Readme is largely generated by Sonnet 4.

## Installation
PySCF is used for electronic structure calculations. It is only operable on a Linux operating system. If one obtains a potential energy surface via different means, in theory it should be possible to run the persistence module (src/2_ph.py) on the dataset. 

To run this pipeline, use the following commands:

```bash
git clone https://github.com/noahsong-sdg/tda_pes
cd tda_pes
```

For Python dependencies:
```bash
conda env create -f environment.yaml
conda activate tda_pes
```

For Julia dependencies:
```bash
julia --project=. -e 'using Pkg; Pkg.instantiate()'
```

## Workflow Overview

This project provides a complete pipeline for topological data analysis of molecular potential energy surfaces:

1. **Generate PES data** using quantum chemistry calculations
2. **Analyze topology** using persistent homology with multiple methods
3. **Visualize results** with comprehensive plots and chemical interpretation

## Current Architecture

The project is now primarily Python-based with a modular TDA analysis system:

### Core Analysis Tools
- `ph.py`: Main command-line tool for single-dataset analysis
- `ph_utils.py`: Modular TDA utilities and comparison methods
- `compare_methods.py`: Compare different TDA approaches on the same dataset
- `compare_alpha_rips.py`: Specific Alpha vs Rips comparison

### PES Generation (src/pes_gen/)
- `pes_v3.py`: Main PES calculation engine
- `quantum.py`: Quantum chemistry interface (PySCF)
- `conformer_rdkit.py`: RDKit conformer generation
- `data_structures.py`: Data structures for molecular systems

## Basic Usage

### Single Dataset Analysis
```bash
python ph.py data/nh3_pes.dat
```

This produces a comprehensive 2×2 analysis plot:
- **Top-left**: PES visualization (1D line, 2D surface, 3D slice)
- **Top-right**: Persistence diagram with H0/H1/H2 features
- **Bottom-left**: H0 persistence barcodes
- **Bottom-right**: H1 persistence barcodes

Features include:
- **Automatic spurious detection**: Identifies and marks invalid topological features
- **Generator visualization**: Shows actual birth/death simplices on the PES
- **Chemical interpretation**: Provides molecular context for topological features

### Method Comparison
```bash
python compare_methods.py data/butane_v3.dat
```

Compares Alpha Complex vs Rips Complex approaches with identical visualization formats.

### PES Generation
```bash
python src/pes_gen/pes_v3.py input/butane.zmat
```

Generates potential energy surface data from Z-matrix templates with variable parameters marked as `{variable_name}`.

## TDA Methods Available

### Standard Methods
- **Alpha Complex**: Geometric approach using Delaunay triangulation (optimal for ≤3D)
- **Rips Complex**: Distance-based approach (works for any dimension)
- **Cubical Complex**: Grid-based approach for regular datasets

### Advanced Sublevel Methods (ph_utils.py)
- **True Sublevel**: Proper sublevel sets {x : f(x) ≤ t} using energy ordering
- **Density-Based**: Kernel smoothing before sublevel filtration
- **Adaptive Methods**: Energy-weighted distance calculations

## Data Format

Multi-column data files with energy as the last column:
```
# 1D: coordinate + energy
angle   energy
0.0     0.005
90.0    0.003

# 2D: two coordinates + energy  
phi     psi     energy
0.0     0.0     0.010
30.0    30.0    0.008

# 3D+: multiple coordinates + energy
x       y       z       energy
1.0     2.0     3.0     0.015
```

## Auto-Detection Features
- **Coordinate identification**: Angles, bond lengths, radians, etc.
- **Dimensionality detection**: 1D-3D handled optimally, 4D+ with warnings
- **Periodicity handling**: Automatic detection of periodic coordinates
- **Grid vs point cloud**: Different handling for regular vs irregular data

## Example Datasets

In `data/` directory:
- `nh3_pes.dat`: Ammonia pyramidal inversion (1D)
- `butane_v3.dat`: Butane torsional flexibility (1D) 
- `aspirin_pes.dat`: Aspirin conformational landscape (2D)

## Chemical Interpretation

- **H0 features**: Energy basins and local minima regions
- **H1 features**: Transition state cycles connecting conformational basins
- **H2+ features**: Higher-dimensional topological structures
- **Persistence**: Energetic significance of topological features
- **Spurious detection**: Automatic identification of computational artifacts

## Modular Design

The `TDAVisualizer` class in `ph_utils.py` provides a universal plotting system:
- **Method-agnostic**: Works with any TDA approach
- **Standardized output**: Consistent 2×2 visualization layout
- **Extensible**: Easy to add new TDA methods
- **Validation**: Built-in spurious feature detection

This architecture allows direct comparison between different topological approaches while maintaining consistent visualization and interpretation.
